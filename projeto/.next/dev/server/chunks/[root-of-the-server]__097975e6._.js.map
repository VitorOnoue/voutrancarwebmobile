{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/willi/Downloads/web/favoris-next/app/api/csv/register/route.js"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst CSV_PATH = path.resolve(process.cwd(), 'users_plain.csv');\r\n\r\nfunction ensureCsv() {\r\n  if (!fs.existsSync(CSV_PATH)) {\r\n    fs.writeFileSync(CSV_PATH, 'email,password,created_at\\n', 'utf-8');\r\n  }\r\n}\r\n\r\nfunction csvSanitize(v) {\r\n  const s = String(v ?? '').replace(/\"/g, '\"\"');\r\n  return /^[=+\\-@]/.test(s) ? \"'\" + s : s;\r\n}\r\n\r\nexport async function POST(request) {\r\n  const body = await request.json();\r\n  const { email, password } = body || {};\r\n  if (!email || !password) {\r\n    return new Response(JSON.stringify({ error: 'email and password required' }), {\r\n      status: 400,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n  ensureCsv();\r\n  const line = `\"${csvSanitize(String(email).toLowerCase())}\",\"${csvSanitize(\r\n    password,\r\n  )}\",\"${new Date().toISOString()}\"\\n`;\r\n  try {\r\n    fs.appendFileSync(CSV_PATH, line, 'utf-8');\r\n    return new Response(JSON.stringify({ ok: true }), {\r\n      status: 200,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  } catch (err) {\r\n    console.error('CSV write error:', err);\r\n    return new Response(JSON.stringify({ error: 'write failed' }), {\r\n      status: 500,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n}\r\n\r\nexport async function GET() {\r\n  ensureCsv();\r\n  const csv = fs.readFileSync(CSV_PATH, 'utf-8');\r\n  return new Response(csv, {\r\n    status: 200,\r\n    headers: {\r\n      'Content-Type': 'text/csv',\r\n      'Content-Disposition': 'attachment; filename=\"users_plain.csv\"',\r\n    },\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,WAAW,4GAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI;AAE7C,SAAS;IACP,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,WAAW;QAC5B,wGAAE,CAAC,aAAa,CAAC,UAAU,+BAA+B;IAC5D;AACF;AAEA,SAAS,YAAY,CAAC;IACpB,MAAM,IAAI,OAAO,KAAK,IAAI,OAAO,CAAC,MAAM;IACxC,OAAO,WAAW,IAAI,CAAC,KAAK,MAAM,IAAI;AACxC;AAEO,eAAe,KAAK,OAAO;IAChC,MAAM,OAAO,MAAM,QAAQ,IAAI;IAC/B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,QAAQ,CAAC;IACrC,IAAI,CAAC,SAAS,CAAC,UAAU;QACvB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAA8B,IAAI;YAC5E,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;IACA;IACA,MAAM,OAAO,CAAC,CAAC,EAAE,YAAY,OAAO,OAAO,WAAW,IAAI,GAAG,EAAE,YAC7D,UACA,GAAG,EAAE,IAAI,OAAO,WAAW,GAAG,GAAG,CAAC;IACpC,IAAI;QACF,wGAAE,CAAC,cAAc,CAAC,UAAU,MAAM;QAClC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,IAAI;QAAK,IAAI;YAChD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAe,IAAI;YAC7D,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF;AAEO,eAAe;IACpB;IACA,MAAM,MAAM,wGAAE,CAAC,YAAY,CAAC,UAAU;IACtC,OAAO,IAAI,SAAS,KAAK;QACvB,QAAQ;QACR,SAAS;YACP,gBAAgB;YAChB,uBAAuB;QACzB;IACF;AACF"}}]
}