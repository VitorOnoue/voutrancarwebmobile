<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Criar conta â€” Favoris</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <header>
    <nav class="container nav" aria-label="Barra superior">
      <h1 class="logo"><span class="logo-badge" aria-hidden="true"></span> Loren Ypson</h1>
      <ul class="nav-actions" aria-label="NavegaÃ§Ã£o principal">
        <li><a href="index.html" id="lnkHome">InÃ­cio</a></li>
        <li><a class="btn btn-outline" href="login.html">Entrar</a></li>
        <li><a href="register.html" aria-current="page">Criar conta</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <section class="hero" aria-label="Cadastro">
      <h2 class="title">Crie sua conta</h2>
      <p class="subtitle">Seus dados ficam salvos no seu navegador (somente na sua mÃ¡quina).</p>

      <form id="formRegister" class="auth-form card-like">
        <label class="input">
          <span>ðŸ“§</span><input name="email" type="email" placeholder="email@exemplo.com" required />
        </label>
        <label class="input">
          <span>ðŸ”’</span><input name="password" type="password" placeholder="Senha" required />
        </label>
        <button class="btn btn-primary" type="submit">Criar conta</button>
        <p class="muted">JÃ¡ tem conta? <a href="login.html">Entre aqui</a>.</p>
      </form>
    </section>
  </main>

  <script src="../js/auth.js"></script>
  <script>
document.querySelector('#formRegister').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = new FormData(e.currentTarget);
  const email = (data.get('email')||'').toString().trim().toLowerCase();
  const password = (data.get('password')||'').toString();

  if(!email || !password){ alert('Preencha e-mail e senha'); return; }
  const users = loadUsers();
  if(users.find(u=>u.email===email)){ alert('E-mail jÃ¡ cadastrado'); return; }
  users.push({ email, password }); // protÃ³tipo (sem hash)
  saveUsers(users);
  setSession({ email });

  // Notifica o backend CSV (nÃ£o bloqueia redirecionamento se falhar)
  try {
    await fetch('http://localhost:3000/api/csv/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
  } catch(err){
    console.warn('Falha ao registrar no CSV:', err);
  }

  location.href = '../index.html';
});
</script>
</body>
</html>
